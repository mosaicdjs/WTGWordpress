<?php
/* Register menus */

register_nav_menus(array( 'main_menu' => 'Main Menu'));
register_nav_menus(array( 'partners_menu' => 'Partners Menu'));
register_nav_menus(array( 'administrators_menu' => 'Administrators Menu'));


register_nav_menus(array( 'footer_menu1' => 'Footer Menu 1'));
register_nav_menus(array( 'footer_menu2' => 'Footer Menu 2'));
register_nav_menus(array( 'footer_menu3' => 'Footer Menu 3'));
register_nav_menus(array( 'footer_menu4' => 'Footer Menu 4'));

/* Register widget areas */

add_action( 'widgets_init', 'theme_widgets_init' );
function theme_widgets_init()
{

    register_sidebar( array (
        'name' => 'followUs',
        'id' => 'followUs',
        'class' => 'followus',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );

    register_sidebar( array (
        'name' => 'Homepage Features',
        'id' => 'homepage-features',
        'class' => 'homepage-features',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );

    register_sidebar( array (
        'name' => 'Homepage Ad Container',
        'id' => 'homepage-ad-container',
        'class' => 'homepage-ad-container',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );

    
    register_sidebar( array (
        'name' => 'Homepage Food and Drinks',
        'id' => 'homepage-fandd',
        'class' => 'homepage-fandd',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Homepage City guides',
        'id' => 'homepage-cityguides',
        'class' => 'homepage-cityguides',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Homepage Country guides',
        'id' => 'homepage-countryguides',
        'class' => 'homepage-countryguides',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Footer Top',
        'id' => 'footer-top',
        'class' => 'footer-top',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Footer Bottom left',
        'id' => 'footer-bottom-left',
        'class' => 'footer-bottom-left',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );

    register_sidebar( array (
        'name' => 'Footer Bottom Right',
        'id' => 'footer-bottom-right',
        'class' => 'footer-bottom-right',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Copyright',
        'id' => 'copyright',
        'class' => 'copyright',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Continent Widgets 1',
        'id' => 'continent-widgets1',
        'class' => 'continent-widgets1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );

    register_sidebar( array (
        'name' => 'Country Widgets 1',
        'id' => 'country-widgets1',
        'class' => 'country-widgets1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );

    register_sidebar( array (
        'name' => 'Country Widgets 2',
        'id' => 'country-widgets2',
        'class' => 'country-widgets2',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Country Widgets 3',
        'id' => 'country-widgets3',
        'class' => 'country-widgets3',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'City Widgets 1',
        'id' => 'city-widgets1',
        'class' => 'city-widgets1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );

    register_sidebar( array (
        'name' => 'City Widgets 2',
        'id' => 'city-widgets2',
        'class' => 'city-widgets2',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'City Widgets 3',
        'id' => 'city-widgets3',
        'class' => 'city-widgets3',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Features Widgets 1',
        'id' => 'features-widgets1',
        'class' => 'features-widgets1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );

    register_sidebar( array (
        'name' => 'Features Widgets 2',
        'id' => 'features-widgets2',
        'class' => 'features-widgets2',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Features Widgets 3',
        'id' => 'features-widgets3',
        'class' => 'features-widgets3',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Features Widgets 4',
        'id' => 'features-widgets4',
        'class' => 'features-widgets4',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Features Widgets 5',
        'id' => 'features-widgets5',
        'class' => 'features-widgets5',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    register_sidebar( array (
        'name' => 'Features Widgets 6',
        'id' => 'features-widgets6',
        'class' => 'features-widgets6',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Guides Widgets 1',
        'id' => 'guides-widgets1',
        'class' => 'guides-widgets1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );

    register_sidebar( array (
        'name' => 'Guides Widgets 2',
        'id' => 'guides-widgets2',
        'class' => 'guides-widgets2',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Guides Sidebar Widgets 1',
        'id' => 'guides-side-widgets1',
        'class' => 'guides-side-widgets1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Airport Widgets 1',
        'id' => 'airport-widgets1',
        'class' => 'airport-widget1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Beach Widgets 1',
        'id' => 'beach-widgets1',
        'class' => 'beach-widget1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Cruise Widgets 1',
        'id' => 'cruise-widgets1',
        'class' => 'cruise-widget1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Ski Widgets 1',
        'id' => 'ski-widgets1',
        'class' => 'ski-widget1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Passport Visa Widgets 1',
        'id' => 'passport-widgets1',
        'class' => 'passport-widget1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
    
    register_sidebar( array (
        'name' => 'Public Holidays Widgets 1',
        'id' => 'pubhols-widgets1',
        'class' => 'pubhols-widget1',
        'before_widget' => '',
        'after_widget' => '',
        'before_title' => '',
        'after_title' => '',
    ) );
}
add_filter('wp_nav_menu_items','add_search_box_to_menu', 10, 2);
function add_search_box_to_menu( $items, $args ) {
    $html = '<li class="search_header">
                <form class="search_carousel" action="'.get_bloginfo('url').'" method="get">
                    <div class="form-group">
                        <input type="search" name="s" class="form-control" placeholder="Search" value="'.the_search_query().'">
                    
                    </div>
                </form>
                <a href="#">
                    <div class="search-icon"></div>
                </a>
            </li>

            <li class="head_search">
                <!-- <a href="#" class="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"> -->
                <a href="#" class="firstLetterSearch">
                <div class="search-icon"></div>
                </a>
                <div class="dropdown-menu searchForm" aria-labelledby="dropdownMenu1">
                    <span>Search</span>
                    <form class="subscribe" action="'.get_bloginfo('url').'" method="get">
                        <div class="form-group">
                            <input type="search" name="s" class="form-control" placeholder="What are you looking for?" value="'.the_search_query().'">
                          
                        </div>
                        <button type="submit" class="btn btn-link">
                            <div class="subscribe-arrow"></div>
                        </button>
                    </form>
                </div>
            </li>';

 
echo '</ul>';

            $continents = get_terms( array( 'taxonomy' => 'wtg_continent', 'hide_empty' => false, ) );

            $html .= '
            <li class="dropdown">
                <a class="destinations dropdown-toggle" id="dropdownMenu2" data-toggle="dropdown" href="#">Destinations</a>
                <div class="destinations dropdown-menu" aria-labelledby="dropdownMenu2">';
                foreach ($continents as $continent)
                {
                    $continentImage = get_term_meta($continent->term_id,'continent_image',true);
                    $imageDetails = wp_get_attachment_image_src( $continentImage, 'thumbnail');
					$imageURL = $imageDetails [0];
                    $html .= '
                        <div margin-bottom:5px">
                            <a style="color:#fff" href="/guides/'.$continent->slug.'/">
                                <img src="'.$imageURL.'" style="width:50px; margin-right:10px; margin-bottom:10px">
                                '.$continent->name.'
                            </a>
                        </div>';
                }
                $html .= '
                </div>
            </li>';

            $page = get_page_by_title( 'Guides A-Z' );
            //$args = array('post_parent' => $page->ID); 
            $subPages = get_children(array('post_parent' => $page->ID, 'orderby' => 'name', 'order' => 'ASC'));
            $html .= '
            <li class="dropdown">
                <a class="destinations dropdown-toggle" id="dropdownMenu3" data-toggle="dropdown" href="#">Guides A-Z</a>
                <div class="destinations dropdown-menu" aria-labelledby="dropdownMenu3">';
                foreach ($subPages as $subPage)
                {
                    $postID = $subPage->ID;
                    $html .= '
                        <div style="padding-top:10px; padding-bottom:10px">
                            <a style="color:#fff; font-size:16px" href="'.get_the_permalink($postID).'">'.get_the_title($postID).'</a>
                        </div>';
                }
                $html .= '
                </div>

            </li>';


        if( $args->theme_location == 'main_menu' ) return $html.$items;

        return $items;
}

function add_search_to_wp_menu ( $items, $args ) {
	if( 'primary' === $args -> theme_location ) {
$items .= '<li class="menu-item menu-item-search">';
$items .= '<form method="get" class="menu-search-form" action="' . get_bloginfo('home') . '/">
            <p>
            <input class="text_input" type="text" value="Enter Text &amp; Click to Search" name="s" id="s" onfocus="if (this.value == \'Enter Text &amp; Click to Search\') {this.value = \'\';}" onblur="if (this.value == \'\') {this.value = \'Enter Text &amp; Click to Search\';}" />
            <input type="submit" class="my-wp-search" id="searchsubmit" value="search" />
            </p>
            </form>';
$items .= '</li>';
	}
return $items;
}

add_filter('wp_nav_menu_items','add_bookings_to_menu', 10, 2);
function add_bookings_to_menu( $items, $args ) {
    $searchTerm = '';
    $title = '';
    $bookingLink = false;    
        $bookingLink = 'https://www.hotelscombined.com/?a_aid=211201';

    
    if(!is_singular('guides')){
		
    } else {
        $postid = get_the_ID();
        $guideTerms = get_the_terms($postid,'wtg_guide_type');
        $guideType = $guideTerms[0]->slug;
        $bookingLink = 'https://www.hotelscombined.com/?a_aid=211201';

        if($guideType == 'city'){
            $searchTerm = get_the_title($postid);
            $title = 'in '.$searchTerm;
            $searchTerm = preg_replace('/\s+/', '_', $searchTerm);
 
            $bookingLink = 'https://www.hotelscombined.com/Place/'.$searchTerm.'.htm?a_aid=211201';
        } 
    }

    
    $html = "<li class='booking-menu-item'>
                <a target='_blank' rel='noindex nofollow' href='$bookingLink'>Hotels $title</a>
            </li>";
    if( $args->theme_location == 'main_menu' )
        return $items.$html;

    return $items;
}

function add_menu_attributes( $atts, $item, $args ) {
  $atts['itemprop'] = 'url';
  return $atts;
}
add_filter( 'nav_menu_link_attributes', 'add_menu_attributes', 10, 3 );



?>