jQuery(document).ready(function(j){var m=j("#mailster_nonce").val(),p=j(document.body).hasClass("mobile"),t=j(document.body).hasClass("index-php"),a=j(".postbox .handlediv"),f=j(".mailster-mb-subscribers"),l=j("#mailster-subscriber-range"),b=j("#subscriber-chart-wrap"),e=j("#subscriber-chart"),o,r,h={responsive:true,legend:false,animationEasing:"easeOutExpo",maintainAspectRatio:false,tooltips:{backgroundColor:"rgba(56,56,56,0.9)",displayColors:false,cornerRadius:2,caretSize:8,callbacks:{label:function(x,w){return d(x.yLabel)}}},scales:{xAxes:[{ticks:{maxTicksLimit:20}}],yAxes:[{ticks:{callback:d}}]}};if(e.length){r=e[0].getContext("2d")}l.on("change",function(){s()}).trigger("change");j("a.external").on("click",function(){if(this.href){window.open(this.href)}return false});if(!t){j(".meta-box-sortables").sortable({placeholder:"sortable-placeholder",connectWith:".meta-box-sortables",items:".postbox",handle:".hndle",cursor:"move",delay:(p?200:0),distance:2,tolerance:"pointer",forcePlaceholderSize:true,helper:function(x,w){return w.clone().find(":input").attr("name",function(z,y){return"sort_"+parseInt(Math.random()*100000,10).toString()+"_"+y}).end()},opacity:0.65,update:function(x,w){q()}});j(".postbox .handlediv").each(function(){var w=j(this);w.attr("aria-expanded",!w.parent(".postbox").hasClass("closed"))}).on("click",function(){var w=j(this);w.parent(".postbox").toggleClass("closed");w.attr("aria-expanded",!w.parent(".postbox").hasClass("closed"))})}j(document).on("verified.mailster",function(y,x,z,w){j(".mailster-purchasecode").html(x);j(".mailster-username").html(z);j(".mailster-email").html(w);j("#mailster-mb-mailster").addClass("verified");j("#welcome-panel").delay(2500).fadeTo(400,0,function(){j("#welcome-panel").slideUp(400)})}).on("click",".toggle-indicator",v).on("click",".hide-postbox-tog",function(){j("#"+j(this).val())[j(this).is(":checked")?"show":"hide"]().removeClass("closed");v()}).on("click",".locked",function(){j(".purchasecode").focus().select()}).on("click",".reset-license",function(){if(!confirm(mailsterdashboardL10n.reset_license)){return false}});var k=(function(y){if(!y){return}var C,B=j(".mailster-mb-"+y),D=B.find(".mailster-mb-select"),x=B.find(".mailster-mb-label"),A=B.find(".mailster-mb-link"),w=A.attr("href");if(!D.length){return}D.on("change",function(){z(j(this).val())}).trigger("change");j(document).on("heartbeat-tick",function(F,E){if(C){z(C,true)}});B.find(".piechart").easyPieChart({animate:1000,rotate:180,barColor:"#2BB3E7",trackColor:"#f3f3f3",lineWidth:9,size:75,lineCap:"butt",onStep:function(E){this.$el.find("span").text(Math.round(E))},onStop:function(E){this.$el.find("span").text(Math.round(E))}});function z(E,F){if(!F){B.addClass("mailster-loading")}c("get_dashboard_data",{type:y,id:E},function(G){var H=G.data;A.html(H.name).removeAttr("class").addClass("mailster-mb-link").attr("href",w.replace("%d",H.ID));if(H.status){A.addClass("status-"+H.status)}B.find(".stats-total").html(H.sent_formatted);B.find(".stats-open").data("easyPieChart").update(H.openrate*100);B.find(".stats-clicks").data("easyPieChart").update(H.clickrate*100);B.find(".stats-unsubscribes").data("easyPieChart").update(H.unsubscriberate*100);B.find(".stats-bounces").data("easyPieChart").update(H.bouncerate*100);C=H.ID;B.removeClass("mailster-loading")})}});var n=new k("campaigns");var i=new k("lists");function s(x,z,w,y){f.addClass("mailster-loading");c("get_dashboard_chart",{range:l.val()},function(A){g();f.removeClass("mailster-loading");if(!o){o=new Chart(r,{type:"line",data:A.chart,options:h})}})}function g(){o=null;if(e){e.remove()}e=j("<canvas>").prependTo(b);r=e[0].getContext("2d");e.attr({width:b.width(),height:b.height()})}function u(){q();v()}function q(){var w={};j.each(j(".postbox-container"),function(){var y=j(this).data("id");j.each(j(this).find(".postbox"),function(){if(!w[y]){w[y]=[]}w[y].push(this.id)});if(w[y]){w[y]=w[y].join(",")}});var x={action:"meta-box-order",_ajax_nonce:j("#meta-box-order-nonce").val(),page:"newsletter_page_mailster_dashboard",order:w};j.post(ajaxurl,x)}function v(){var y=j(".postbox:hidden").map(function(){return this.id}).toArray(),w=j(".postbox.closed").map(function(){return this.id}).toArray();var x={action:"closed-postboxes",closedpostboxesnonce:j("#closedpostboxesnonce").val(),closed:w.length?w.join(","):"",hidden:y.length?y.join(","):"",page:"newsletter_page_mailster_dashboard"};j.post(ajaxurl,x)}function d(w){if(w>=1000000){return(w/1000).toFixed(1)+"M"}else{if(w>=1000){return(w/1000).toFixed(1)+"K"}}return !(w%1)?w:""}function c(z,y,A,x,w){if(j.isFunction(y)){if(j.isFunction(A)){x=A}A=y;y={}}j.ajax({type:"POST",url:ajaxurl,data:j.extend({action:"mailster_"+z,_wpnonce:m},y),success:function(C,D,B){A&&A.call(this,C,D,B)},error:function(B,D,C){if(D=="error"&&!C){return}if(console){console.error(j.trim(B.responseText))}x&&x.call(this,B,D,C)},dataType:w?w:"JSON"})}});